# This is responsible for setting up the target warehouse schema with appropriate partition schemes,
# partition functions, and table schemas prior to loading in data from each of the sites
# We can configure this to run as a startup job, and assume schema changes will be accompanied by a PETL restart

type: "job-pipeline"
configuration:
  jobs:
    - path: "templates/create-partitions/job.yml"
    - type: "iterating-job"
      configuration:
        execution:
          maxConcurrentJobs: 1
        jobTemplate:
          path: "templates/recreate-table-if-schema-changed/job.yml"
        iterations:
          - tableName: "all_lab_orders"
          - tableName: "all_lab_results"
          - tableName: "covid_admission"
          - tableName: "covid_diagnoses"
          - tableName: "covid_discharge"
          - tableName: "covid_disposition"
          - tableName: "covid_lab_test"
          - tableName: "covid_visit"
          - tableName: "echocardiogram"
          - tableName: "mch_birth"
          - tableName: "mch_delivery"
          - tableName: "mch_patient"
          - tableName: "mch_pregnancy"
          - tableName: "mch_status"
          - tableName: "mch_visit"
          - tableName: "tb_lab_results"
          - tableName: "tb_screening"
          - tableName: "vaccinations_anc"
<htmlform formUuid="db041f90-938b-44b2-ae70-2ef0da6c693e"
          formName="PMTCT History" formVersion="1.0">

    <style type="text/css">
        <ifMode mode="VIEW" include="false">

            #data-collection {
                display: inline-block;
                width: 58%;
                vertical-align: top;
            }

            .side-by-side label {
                display: inline-block;
            }

            form input[type="radio"], .form input[type="radio"] {
                float: none;
                display: inline-block;
            }

            .two-columns-o {
                column-count: 2;
                -webkit-column-count: 2;
                -moz-column-count: 2;
            }

            .five-columns, .four-columns, .three-columns, .two-columns {
                display: table;
                height: 100%;
                width: 100%;
            }

            .two-columns > div {
                display: table-cell;
                width: 50%;
            }

            .four-columns > div {
              display: table-cell;
              width: 25%;
            }

            p.radio > * {
                display: inline;
                float: none !important;
                min-width: initial;
            }

            .flex-questions {
                display: flex;
                flex-wrap: wrap;
            }

            .flex-questions > div {
                margin-right: 16px;
                margin-bottom: 8px;
            }

            form fieldset {
                min-width: 90%;
                display: block;
            }

            .section-container {
                background: #F2F2F2;
                box-shadow: 3px 3px 3px 1px rgba(0, 0, 0, 0.2);
                padding: 10px 5px 10px 15px;
                line-height: 1.5em; /*add this for vertical spacing between elements*/
            }

            .section-container-color {
                background: #F2F2F2;
                box-shadow: 3px 3px 3px 1px rgba(0, 0, 0, 0.2);
                padding: 10px 5px 10px 15px;
                line-height: 1.5em; /*add this for vertical spacing between elements*/
            }

            .section-container input[type="checkbox"] {
                margin: 0px 5px; /*changed values to vertical, horizontal*/
                top:5px; /*added to offset the checkbox position to line up*/
            }

            .cb-align input[type=checkbox] {
                margin: 0px 5px;
                top:0px;
            }

            .section-container label,
            .section-container-color label {
                margin: 0px;
            }

            .section {
                width: 95%;
            }

            .family-history-item .label {
                display: inline-block;
                width: 250px;
            }
            .family-history-item .relative {
                display: inline-block;
                width: 120px;
            }

            .past-medical-history-item input[type=checkbox] {
                float: none;
                vertical-align: middle;
            }

            .past-medical-history-item input[type=text] {
                min-width: 200px;
                display: inline !important;
                vertical-align: middle;
                padding: 1px 10px;
            }

            .past-medical-history-item > span, .past-medical-history-item > label {
                display: inline !important;
                vertical-align: middle;
            }
        </ifMode>
    </style>

    <ifMode mode="VIEW" include="false" >
        <h3>
            <uimessage code="pihcore.history.label"/>
        </h3>

        <script type="text/javascript">
            jq(function() {
                setUpEdd('<lookup expression="encounter.getEncounterDatetime().getTime()"/>', '<uimessage code="pihcore.weeks"/>');
                setUpNextButtonForSections('pmtct-history');
                setUpExpandableContacts('<uimessage code="pihcore.invalid.phoneNumber"/>');
                setUpExpandableTransferAndReferralDetails();
                setUpDatepickerStartAndEndDateValidation('mom-syph-treat-start','mom-syph-treat-end');
                setUpDatepickerStartAndEndDateValidation('partner-syph-treat-start','partner-syph-treat-end');
                setUpObsWithObsDateTime('syph-checkbox');
            });
        </script>
    </ifMode>

    <!-- Program enrollment (if the patient hasn't already been enrolled); use first ancestor location tagged as Program Location-->
    <enrollInProgram programId="HIV" locationTag="Program Location"/>

    <section id="chwName-section" sectionTag="fieldset" headerTag="legend" headerStyle="title"
             headerCode="pihcore.chw">
        <div class="section-container-color">
            <div id="chw-name-details">
                <p id="chw-name">
                    <label>
                        <uimessage code="pihcore.nameCHW"/>:
                    </label>
                    <obs id="chwName" conceptId="CIEL:164141"/>
                </p>
            </div>
        </div>
    </section>

    <section id="transferIn" sectionTag="fieldset" headerTag="legend" headerStyle="title"
             headerCode="pihcore.transferReferralIn">
        <div class="section-container-color">
            <obsgroup groupingConceptId="PIH:13169">
                <label>
                    <uimessage code="pihcore.externalTransferQuestion"/>
                </label>
                <p class="side-by-side">
                    <obs id="transfer-referral-spots"
                         conceptId="PIH:REFERRAL OR TRANSFER" style="radio"
                         answerConceptIds="PIH:11521,PIH:6965"
                         answerCodes="pihcore.referral,pihcore.transfer"
                         answerSeparator="" toggle="transfer-referral-out-details"/>
                </p>
                <div id="transfer-referral-out-details">
                    <p class="side-by-side">
                        <obs id="transfer-out-spots"
                             conceptId="PIH:REFERRED FROM ANOTHER SITE" style="radio"
                             answerConceptIds="PIH:8855,PIH:8856"
                             answerCodes="pihcore.internal,pihcore.external"
                             answerSeparator="">
                            <controls>
                                <when value="PIH:8855" thenDisplay="#internal-out"/>
                                <when value="PIH:8856" thenDisplay="#external-out"/>
                            </controls>
                        </obs>
                    </p>

                    <p id="internal-out">
                        <label>
                            <uimessage code="pihcore.internalLocation"/>
                        </label>
                        <obs conceptId="PIH:8621" style="location" answerLocationTags="Program Location"/>
                    </p>

                    <p id="external-out">
                        <label>
                            <uimessage code="pihcore.externalLocation"/>
                        </label>
                        <obs conceptId="PIH:11483"/>
                        <obs conceptId="PIH:PEPFAR partner site"
                             answerConceptId="CIEL:1065" answerCode="pihcore.pepfarSite"/>
                    </p>
                </div>
            </obsgroup>
        </div>
    </section>

    <section id="hiv-serology" sectionTag="fieldset" headerTag="legend" headerStyle="title"
             headerCode="pihcore.hiv.serology.title">
        <div class="section-container">
            <div class="two-columns">
                <div>
                <label>
                    <uimessage code="pihcore.testOrderedBy"/>
                </label>

                <repeat>
                    <template>
                        <obs conceptId="CIEL:159936"
                             answerConceptId="{point}" answerCode="{message}"/>
                    </template>

                    <render point="CIEL:159940" message="pihcore.testLocation.vct" comment="vct"/>
                    <render point="CIEL:159937" message="pihcore.testLocation.mch" comment="MCH"/>
                    <render point="CIEL:160542" message="pihcore.testLocation.primary" comment="Outpatient"/>
                    <render point="CIEL:159939" message="pihcore.testLocation.mobile" comment="Mobile"/>
                    <render point="PIH:2714" message="pihcore.testLocation.familyPlan" comment="Family planning clinic"/>
                    <render point="PIH:2235" message="pihcore.testLocation.maternity" comment="inpatient maternity"/>
                    <render point="PIH:6298" message="pihcore.testLocation.surgery" comment="surgery"/>
                    <render point="PIH:7891" message="pihcore.testLocation.intMed" comment="inpatient internal med"/>
                    <render point="PIH:2717" message="pihcore.testLocation.pedWard" comment="inpatient peds"/>
                 </repeat>

                <obs conceptId="CIEL:159936"
                     answerConceptId="CIEL:5622" answerCode="pihcore.other"
                     commentFieldCode="zl.ifOtherSpecify" />

                </div>

                <div>
                    <p>
                        <label>
                            <uimessage code="pihcore.hiv.testDate"/>
                        </label>
                        <obs conceptId="CIEL:164400"/>
                    </p>

                    <!-- Partner -->
                    <p class="side-by-side">
                        <label>
                            <uimessage code="pihcore.hiv.partnerTesting"/>
                        </label>
                        <br/>
                        <obs conceptId="CIEL:159381"
                            answerConceptIds="CIEL:1066,CIEL:1065,PIH:NO PARTNER"
                            style="radio" answerSeparator="" />
                    </p>
                </div>
            </div>
        </div>
    </section>

    <section id="contacts" sectionTag="fieldset" headerTag="legend" headerStyle="title"
            headerCode="pihcore.contacts">

        <repeat with="['1'],['2'],['3'],['4'],['5'],['6'],['7'],['8'],['9'],['10']">
            <span id="contact-{0}" class="mb-4 flex-questions section-container contacts">
                <obsgroup groupingConceptId="PIH:Contact construct" showIfEmpty="false">

                    <div>
                        <!-- Relationship to patient -->
                        <obs id="relation-{0}" conceptId="CIEL:164352"
                             labelCode="pihcore.contactRelationship"
                             answerConceptIds="CIEL:1527,PIH:GUARDIAN,PIH:PARTNER OR SPOUSE,CIEL:1528,PIH:SIBLING,PIH:OTHER RELATIVE"/>
                         <!-- CIEL codes: 1527=Parent, 1528=Child -->
                    </div>
                    <div>
                        <obs id="contact-first-name-{0}" conceptId="PIH:FIRST NAME" labelCode="pihcore.firstName"/>
                    </div>
                    <div>
                        <obs id="contact-last-name-{0}" conceptId="PIH:LAST NAME" labelCode="pihcore.lastName"/>
                    </div>
                    <div>
                        <obs id="contact-age-{0}" conceptId="PIH:AGE" labelCode="pihcore.age"/>
                    </div>
                    <div class="two-columns">
                        <div>
                            <label>
                                <uimessage code="pihcore.dead"/>
                            </label>
                            <p class="side-by-side">
                                <!-- Health status of contact -->
                                <obs id="contact-life-{0}" conceptId="CIEL:163533"
                                     answerConceptIds="PIH:ALIVE,PIH:DEATH,PIH:UNKNOWN"
                                     answerCodes="general.no,general.yes,pihcore.unknown"
                                     style="radio" answerSeparator=""/>
                            </p>
                        </div>
                        <div>
                            <label>
                                <uimessage code="pihcore.hiv.serologicalStatus"/>
                            </label>
                            <p class="side-by-side">
                                <obs id="contact-hiv-status-{0}" conceptId="PIH:RESULT OF HIV TEST"
                                     answerConceptIds="PIH:UNKNOWN,PIH:POSITIVE,PIH:NEGATIVE"
                                     style="radio" answerSeparator=""/>
                            </p>
                        </div>
                    </div>
                    <div class="contact-hiv-phone-{0}">
                        <obs id="contact-hiv-phone-{0}" conceptId="PIH:TELEPHONE NUMBER OF CONTACT"
                             labelCode="pihcore.telephone"/>
                        <span id="contact-phone-error-message-{0}" class="text-danger"></span>
                    </div>

                </obsgroup>
            </span>
        </repeat>
        <ifMode mode="VIEW" include="false">
            <button id="show-more-contacts-button" type="button">
                <uimessage code="pihcore.showMore"/>
            </button>
            <button id="show-less-contacts-button" type="button">
                <uimessage code="pihcore.showLess"/>
            </button>
        </ifMode>
    </section>

    <section id="transmission" sectionTag="fieldset" headerTag="legend" headerStyle="title"
             headerCode="pihcore.modeOfTransmission">
    <div class="section-container">
        <table>
            <tr>
                <th>
                    Mode
                </th>
                <th>
                    Date
                </th>
            </tr>
            <repeat>
                <template>
                    <obsgroup groupingConceptId="CIEL:163288">
                    <tr>
                        <td>
                            <obs conceptId="CIEL:160581"
                                 answerConceptId="{cId}"
                                 style="checkbox"
                                 toggle="{id: '{toggle}-trans-date', style: 'dim'}"/>
                        </td>
                        <td id="{toggle}-trans-date">
                            <obs conceptId="CIEL:162601" allowTime="false" />
                        </td>
                    </tr>
                    </obsgroup>
                </template>
                <render mode="Rapports sexuels avec un homme" cId="CIEL:163290" toggle="men" />
                <render mode="Rapports sexuels avec une femme" cId="CIEL:163291" toggle="women" />
                <render mode="Injection de drogues" cId="CIEL:105" toggle="drugs"/>
                <render mode="Bénéficier de sang/dérivé sanguin" cId="CIEL:1063" toggle="blood" />
                <render mode="Transmission mère a enfant" cId="CIEL:163273" toggle="pmtct "/>
                <render mode="Accident d'exposition au sang" cId="CIEL:163274" toggle="accident-blood"/>
                <render mode="Rapports hétérosexuelles avec personne SIDA/VIH+" cId="CIEL:163289" toggle="hiv-person" />
                <render mode="Rapports hétérosexuelles avec personne qui s'injecte de la drogue" cId="PIH:11534" toggle="with-drug-person" />
                <render mode="Rapports hétérosexuelles avec personne homme bisexuel" cId="CIEL:165433" toggle="with-bisexual" />
                <render mode="Rapports hétérosexuelles avec personne bénéficier de sang/dérivé sanguin" cId="CIEL:165434" toggle="with-blood-person" />
            </repeat>

            <obsgroup groupingConceptId="CIEL:163288">
                <tr>
                    <td>
                        <obs conceptId="CIEL:160581"
                             answerConceptId="CIEL:5622"
                             style="checkbox" commentFieldCode=""
                             toggle="{id: 'other-trans-date', style: 'dim'}"/>
                    </td>
                    <td id="other-trans-date">
                        <obs conceptId="CIEL:162601" allowTime="false" />
                    </td>
                </tr>
            </obsgroup>
        </table>
    </div>
    </section>

    <section id="risk" sectionTag="fieldset" headerTag="legend" headerStyle="title"
             headerCode="pihcore.otherFactors">
        <div class="section-container">
            <table>
                <tr>
                    <th colspan="2">
                        <uimessage code="pihcore.otherRiskFactors"/>
                    </th>
                    <th>
                        Date
                    </th>
                </tr>
                <repeat>
                    <template>
                        <obsgroup groupingConceptId="CIEL:163292">
                            <tr>
                                <td>
                                    <label>
                                        <uimessage code="pihcore.{toggle}" />
                                    </label>
                                </td>
                                <td>
                                    <p class="radio">
                                        <obs conceptId="{cId}"
                                             answerConceptIds="CIEL:1066,CIEL:1065,CIEL:1067"
                                             answerCodes="pihcore.no.oneChar,pihcore.yes.oneChar,pihcore.unknown.oneChar"
                                             style="radio" answerSeparator=""
                                             toggle="{id: '{toggle}-risk-date', style: 'dim'}"/>
                                    </p>
                                </td>
                                <td id="{toggle}-risk-date">
                                    <obs conceptId="CIEL:162601" allowTime="false" />
                                </td>
                            </tr>
                        </obsgroup>
                    </template>
                    <render mode="syph" cId="CIEL:163276" toggle="hxSyphilis" />
                    <render mode="IST" cId="CIEL:156660" toggle="hxOtherSTI" />
                    <render mode="violence" cId="CIEL:123160" toggle="victimGBV"/>
                    <render mode="multi" cId="CIEL:5567" toggle="multipleSexPartners" />
                    <render mode="no condom" cId="CIEL:159218" toggle="withoutCondom"/>
                    <render mode="anal" cId="CIEL:163278" toggle="analSex"/>
                    <render mode="withprosex" cId="CIEL:160580" toggle="withSexWorker" />
                    <render mode="sexWorker" cId="CIEL:160579" toggle="sexWorker"/>
                </repeat>

                <obsgroup groupingConceptId="CIEL:163288">
                    <tr>
                        <td colspan="2">
                            <obs conceptId="CIEL:160581"
                                 answerConceptId="PIH:11406"
                                 style="checkbox" commentFieldCode=""
                                 toggle="{id: 'other-risk--date', style: 'dim'}"/>
                        </td>
                        <td id="other-risk-date">
                            <obs conceptId="CIEL:162601" allowTime="false" />
                        </td>
                    </tr>
                </obsgroup>
            </table>

            <div>
                <label>
                    <uimessage code="pihcore.comment"/>
                </label>
                <obs conceptId="PIH:12999" rows="2" />
            </div>
        </div>
    </section>

    <section id="syphilis-section" sectionTag="fieldset" headerTag="legend"
             headerStyle="title" headerCode="Syphilis">

        <div class="section-container">
            <p>
                <obs id="syph-checkbox" conceptId="CIEL:164801" style="checkbox"
                     answerConceptId="CIEL:1065" answerCode="pihcore.screeningSyph"
                     dateLabel="Date" toggle="syph-screen"/>
            </p>
            <p id="syph-screen" class="side-by-side">
                <label>
                    <uimessage code="pihcore.lab.syphilis"/>
                </label>
                <br/>
                <obs conceptId="CIEL:165303" style="radio"
                     answerConceptIds="CIEL:703,CIEL:664,CIEL:1138,PIH:3083"/>
            </p>
            <hr/>

            <div class="two-columns">
                <div>
                    <obsgroup groupingConceptId="CIEL:166557">
                        <p>
                            <obs conceptId="CIEL:1628" style="checkbox"
                                 answerConceptId="CIEL:112493"
                                 answerCode="pihcore.syphilisTreatmentPregnantMother"
                                 toggle="mom-syph-treat"/>
                        </p>
                        <p id="mom-syph-treat">
                            <obs id="mom-syph-treat-start" conceptId="CIEL:163526" labelCode="pihcore.treatmentStartDate"/>
                            <obs id="mom-syph-treat-end" conceptId="CIEL:164384" labelCode="pihcore.treatmentEndDate"/>
                        </p>
                    </obsgroup>
                </div>

                <div>
                    <obsgroup groupingConceptId="CIEL:166558">
                        <p>
                            <obs conceptId="CIEL:1628" style="checkbox"
                                 answerConceptId="CIEL:112493"
                                 answerCode="pihcore.syphilisTreatmentPartner" toggle="partner-syph-treat"/>
                        </p>
                        <p id="partner-syph-treat">
                            <obs id="partner-syph-treat-start" conceptId="CIEL:163526" labelCode="pihcore.treatmentStartDate" />
                            <obs id="partner-syph-treat-end" conceptId="CIEL:164384" labelCode="pihcore.treatmentEndDate" />
                        </p>
                    </obsgroup>
                </div>
            </div>
        </div>

    </section>

    <section id="obgyn-section" sectionTag="fieldset" headerTag="legend"
             headerStyle="title" headerCode="Ob/Gyn">
        <div class="section-container">

            <div class="two-columns">
                <!-- Last menstrual period (LMP or DDR) -->
                <div>
                    <label>
                        <uimessage code="pihcore.pregnancy.lastPeriod"/>
                    </label>
                    <span class="small">
                        <obs id="lastPeriodDate" conceptId="CIEL:1427" allowFutureDates="false"/>
                    </span>
                </div>

                <!-- Due date (DPA) -->
                <div>
                    <label>
                        <uimessage code="pihcore.pregnancy.dueDate"/>
                    </label>
                    <span class="small">
                        <obs id="edd" conceptId="CIEL:5596" allowFutureDates="true"/>
                    </span>
                </div>
            </div>

            <div id="calculated-edd-and-gestational" class="two-columns hidden">
                <div>
                    <span id="calculated-gestational-age-wrapper">
                        <span id="calculated-gestational-age-label">
                            <uimessage code="pihcore.calculatedGestationalAge"/>:&#160;
                        </span>
                        <span id='calculated-gestational-age-value' class="value"></span>
                    </span>
                </div>
                <div>
                    <span id="calculated-edd-wrapper">
                        <span id="calculated-edd-label">
                            <uimessage code="pihcore.calculatedEstimatedDeliveryDate"/>:&#160;
                        </span>
                        <span id='calculated-edd' class="value"></span>
                    </span>
                </div>
            </div>
            <br/>

            <div class="four-columns">
                <div>
                    <label>
                        <uimessage code="pihcore.mch.grava"/>
                    </label>
                    <obs conceptId="CIEL:5624" required="true" id="gravidaInput"/>
                </div>
                <div>
                    <label>
                        <uimessage code="pihcore.mch.para"/>
                    </label>
                    <obs conceptId="CIEL:1053" required="true"/>
                </div>
                <div>
                    <label>
                        <uimessage code="pihcore.mch.abortus"/>
                    </label>
                    <obs conceptId="CIEL:1823" required="true"/>
                </div>
                <div>
                    <label>
                        <uimessage code="pihcore.mch.living"/>
                    </label>
                    <obs conceptId="CIEL:1825" required="true"/>
                </div>
            </div>

            <div class="two-columns">
                <div>
                    <label>
                        <uimessage code="pihcore.durationMenstCycle"/>
                    </label>
                    <obs conceptId="CIEL:160597" />
                </div>
                <div>
                    <label>
                        <uimessage code="pihcore.durationMenses"/>
                    </label>
                    <obs conceptId="CIEL:163732" />
                </div>
            </div>

            <div class="two-columns">
                <div>
                    <p class="radio">
                        <label>
                            <b><uimessage code="Menstruation" /></b>
                        </label>
                        <obs conceptId="CIEL:160600" style="radio"
                             answerConceptIds="CIEL:1065,CIEL:1066"
                             answerCodes="pihcore.regular,pihcore.irregular" />
                    </p>
                </div>
                <div>
                    <!-- Dysmenorrhea -->
                    <obsgroup groupingConceptId="PIH:Visit Diagnoses" showIfEmpty="false">
                        <obs conceptId="PIH:DIAGNOSIS" style="checkbox" answerConceptId="CIEL:127" />
                    </obsgroup>
                </div>
            </div>
        </div>
    </section>

    <section id="hiv-adverse-event" sectionTag="fieldset" headerTag="legend" headerStyle="title"
             headerCode="pihcore.adverseEvent">
        <div class="section-container">
            <p>
                <label>
                    <b>
                        <uimessage code="pihcore.adverseEvent"/>?
                    </b>
                </label>
                <obsgroup groupingConceptId="PIH:1295">
                    <obs conceptId="PIH:1297" style="checkbox"
                         answerConceptId="CIEL:121764"
                         answerCode="emr.yes" toggle="ae" />
                </obsgroup>
            </p>

            <div id="ae">
                <table>
                    <tr>
                        <th>
                            <label>
                                <uimessage code="pihcore.ncd.meds"/>
                            </label>
                        </th>
                        <th>
                            <label>
                                <uimessage code="pihcore.adverseEvent"/>
                            </label>
                        </th>
                        <th>
                            <label>
                                Date
                            </label>
                        </th>
                    </tr>

                    <repeat with="[1],[2],[3]">
                        <obsgroup groupingConceptId="PIH:1295">
                            <tr>
                                <td id="ae-med-{0}">
                                    <obs conceptId="CIEL:160632" />
                                </td>
                                <td id="ae-{0}">
                                    <repeat>
                                        <template>
                                            <obs conceptId="PIH:1297"
                                                 answerConceptId="{concept}"
                                                 style="checkbox" />
                                        </template>
                                        <render concept="CIEL:512"    name="Rash" />
                                        <render concept="CIEL:148888" name="Anaphylaxis"/>
                                        <render concept="CIEL:148787" name="Angioedema"/>
                                        <render concept="CIEL:118983" name="Neuropathy"/>
                                        <render concept="CIEL:116986" name="Hepatitis" />
                                    </repeat>
                                    <obs conceptId="PIH:1297" answerConceptId="CIEL:5622"
                                         commentFieldCode="zl.ifOtherSpecify" style="checkbox" />
                                </td>
                                <td id="ae-date-{0}">
                                    <obs conceptId="PIH:1300" />
                                </td>
                            </tr>
                        </obsgroup>
                    </repeat>
                </table>
            </div>
        </div>
    </section>

    <section id="patient-history" sectionTag="fieldset" headerTag="legend" headerStyle="title"
             headerCode="zl.consultNote.patientHistory.title">
        <div class="section-container">
            <table>
                <tr>
                    <th colspan="2">
                        <uimessage code="pihcore.pathology" />
                    </th>
                    <th>
                        <uimessage code="zl.date" />
                    </th>
                    <th>
                        <uimessage code="pihcore.remarks" />
                    </th>
                </tr>
                <repeat>
                    <template>
                        <obsgroup groupingConceptId="CIEL:1633">
                            <tr>
                                <td id="{name}-mhf">
                                    <!-- Past medical history finding -->
                                    <obs conceptId="CIEL:1628" answerConceptId="{concept}" style="checkbox"
                                         toggle="{id: '{name}-mhf-data', style: 'dim'}"/>
                                </td>
                                <td class="{name}-mhf-data">
                                    <p class="radio">
                                        <obs conceptId="CIEL:1729" style="radio"
                                             answerConceptIds="CIEL:1066,CIEL:1065"
                                             answerCodes="pihcore.no.oneChar,pihcore.yes.oneChar" />
                                    </p>
                                </td>
                                <td class="{name}-mhf-data">
                                    <!-- Date -->
                                    <obs conceptId="CIEL:159948" />
                                </td>
                                <td class="{name}-mhf-data">
                                    <!-- Remarks -->
                                    <obs conceptId="CIEL:160221" />
                                </td>
                            </tr>
                        </obsgroup>
                    </template>

                    <render concept="PIH:PNEUMONIA" name="pneumonia"/>
                    <render concept="PIH:HERPES ZOSTER" name="herpes"/>
                    <render concept="CIEL:5334" name="thrush" />
                    <render concept="PIH:DERMATITIS" name="dermatitis"/>
                    <render concept="CIEL:119175" name="enteropathy"/>
                    <render concept="PIH:DIARRHEA" name="diarrhea" />
                    <render concept="PIH:ANEMIA" name="anemia"/>
                    <render concept="PIH:SEXUALLY TRANSMITTED INFECTION" name="sti"
                            label="pihcore.medicalhistory.sti" />
                    <render concept="CIEL:118983" name="PeripheralNeuropathy"/>
                    <render concept="PIH:SEIZURE" name="seizure"/>
                    <render concept="PIH:995" name="OtherNeuroSympt" />
                    <render concept="PIH:HYPERTENSION" name="htn"
                            label="pihcore.medicalhistory.hypertension"/>
                    <render concept="CIEL:119270" name="otherCardio"/>
                    <render concept="PIH:HEPATITIS" name="hepatitis" />
                    <render concept="PIH:DIABETES" name="diabetes" />
                    <render concept="PIH:SURGERY" name="surgery" />
                    <render concept="PIH:CHOLERA" name="cholera" />
                    <render concept="CIEL:120742" name="chikungunya"/>
                    <render concept="CIEL:165623" name="covid" />
                    <render concept="PIH:OTHER" name="other" />
                </repeat>
            </table>
        </div>
    </section>

    <section id="family-history" sectionTag="fieldset" headerStyle="title" headerTag="legend"
             headerCode="zl.consultNote.familyHistory.title">
        <div class="section-container">
            <familyHistoryRelativeCheckboxes concept="PIH:ASTHMA" relatives="PIH:FATHER,PIH:MOTHER,PIH:SIBLING,PIH:OTHER"/>
            <familyHistoryRelativeCheckboxes concept="PIH:HEART DISEASE" relatives="PIH:FATHER,PIH:MOTHER,PIH:SIBLING,PIH:OTHER"/>
            <familyHistoryRelativeCheckboxes id="familyCancer" class="medicalHistoryText famHistory"
                                             concept="CIEL:116031" label="Cancer"
                                             relatives="PIH:FATHER,PIH:MOTHER,PIH:SIBLING,PIH:OTHER"
                                             specify="true"/>
            <familyHistoryRelativeCheckboxes concept="PIH:DIABETES" relatives="PIH:FATHER,PIH:MOTHER,PIH:SIBLING,PIH:OTHER"/>
            <familyHistoryRelativeCheckboxes concept="PIH:EPILEPSY" relatives="PIH:FATHER,PIH:MOTHER,PIH:SIBLING,PIH:OTHER"/>
            <familyHistoryRelativeCheckboxes concept="CIEL:117635" comment="Hémoglobinopathie"
                                             relatives="PIH:FATHER,PIH:MOTHER,PIH:SIBLING,PIH:OTHER"/>
            <familyHistoryRelativeCheckboxes concept="PIH:HYPERTENSION" label="pihcore.medicalhistory.hypertension"
                                             relatives="PIH:FATHER,PIH:MOTHER,PIH:SIBLING,PIH:OTHER"/>
            <familyHistoryRelativeCheckboxes concept="PIH:TUBERCULOSIS" relatives="PIH:FATHER,PIH:MOTHER,PIH:SIBLING,PIH:OTHER"/>
            <familyHistoryRelativeCheckboxes id="familyOther" class="medicalHistoryText famHistory"
                                             concept="PIH:OTHER" code="pihcore.other"
                                             relatives="PIH:FATHER,PIH:MOTHER,PIH:SIBLING,PIH:OTHER"
                                             specify="true"/>
        </div>
    </section>

    <section id="tb-history" sectionTag="fieldset" headerTag="legend" headerStyle="title"
             headerCode="pihcore.tb.historyTB">
        <div class="section-container">
            <p>
                <label>
                    <uimessage code="pihcore.tb.patientActiveTB" />
                </label>
                <obs conceptId="CIEL:1389" style="checkbox"
                     answerConceptId="CIEL:1065"
                     answerCode="emr.yes"
                     toggle="activeTB" />
            </p>

            <div id="activeTB">
                <p>
                    <label>
                        <uimessage code="pihcore.ifYesTestDate" />
                    </label>
                    <obs conceptId="PIH:11526" />
                </p>

                <!-- Based on HIV EMR form and questions -->
                <div class="two-columns">
                    <div>
                        <!-- Location of TB:  Pulmonary or EP -->
                        <obs conceptId="CIEL:160040" style="checkbox"
                             answerConceptId="CIEL:42" />
                        <obs conceptId="CIEL:160040" style="checkbox"
                             answerConceptId="CIEL:5042" />
                    </div>

                    <div>
                        <!-- DST -->
                        <obs conceptId="PIH:3039" style="checkbox"
                             answerConceptId="CIEL:1065" answerCode="pihcore.dstComplete" />
                        <label>
                            <uimessage code="pihcore.result" />:
                        </label>
                        <obs conceptId="CIEL:159391"  />
                    </div>
                </div>

                <p>
                    <label>
                        <uimessage code="pihcore.longActiveTBTreatmentComment" />
                    </label>
                </p>

                <h3>
                    <uimessage code="pihcore.tbTreatmentHistory"/>
                </h3>
                <table>
                    <tr>
                        <td>
                            <label>
                                <uimessage code="pihcore.treatment"/>
                            </label>
                        </td>
                        <td>
                            <label>
                                <uimessage code="pihcore.startDate"/>
                            </label>
                        </td>
                        <td>
                            <label>
                                <uimessage code="pihcore.endDate"/>
                            </label>
                        </td>
                        <td>
                            <label>
                                <uimessage code="pihcore.treatmentResult"/>
                            </label>
                        </td>
                    </tr>

                    <repeat>
                        <template>
                            <obsgroup groupingConceptId="PIH:1589">
                                <tr>
                                    <td>
                                        <obs id="{obs_id}" conceptId="CIEL:1282" answerConceptId="{concept}"
                                             answerCode="pihcore.tb.{regimen}.{obs_id}"
                                             toggle="{id: '{regimen}', style: 'dim'}" />
                                    </td>
                                    <td class="{regimen}">
                                        <obs conceptId="CIEL:1190"/>
                                    </td>
                                    <td class="{regimen}">
                                        <obs conceptId="CIEL:1191" allowFutureDates="true"/>
                                    </td>
                                    <td id="{regimen}">
                                        <p class="radio">
                                            <obs conceptId="CIEL:6098" style="radio"
                                                 answerConceptIds="CIEL:159791,CIEL:843,CIEL:160031"
                                                 answerCodes="pihcore.cured,pihcore.failure,pihcore.defaulted"
                                                 answerSeparator=""/>
                                        </p>
                                    </td>
                                </tr>
                            </obsgroup>
                        </template>
                        <render concept="PIH:2406" regimen="initialTreatment" obs_id="2_RHZE_4_RH"/>
                        <render concept="PIH:2408" regimen="retreatment" obs_id="2hrze_4hr"/>
                        <render concept="CIEL:159909" regimen="mdrtbTreatment" obs_id="ciel_159909"/>
                    </repeat>
                </table>
            </div>
        </div>
    </section>

    <style>
        .tb-screening-question * {
            display: inline;
            float: none !important;
            min-width: initial;
            vertical-align: middle;
        }
        .tb-screening-question-label {
            display:block;
        }
        .tb-screening-question {
            margin-bottom: 10px;
        }

    </style>


    <section id="tb-screen" sectionTag="fieldset" headerTag="legend" headerStyle="title"
             headerCode="pihcore.tbscreen.title">
        <div class="section-container">
            <div class="two-columns-o">
                <repeat with="['feverSweats','11565'],['wtLoss3kg','11566'],['cough','11567'],['tbContact','11568'],['painfulNodes','11569'],['bloodyCough','970'],['dyspnea','5960'],['chestPain','136']">
                    <div class="radio tb-screening-question">
                        <obs conceptIds="PIH:11563,PIH:11564"
                             answerConceptId="PIH:{1}"
                             labelCode="pihcore.tbscreen.{0}"
                             labelCssClass="tb-screening-question-label"
                             conceptLabels="coreapps.yes,coreapps.no"
                             style="radio" />
                    </div>
                </repeat>
            </div>

            <br/>
            <p>
                <label>
                    <uimessage code="pihcore.tbSuspectedMessage" />
                </label>
            </p>
        </div>
    </section>

    <section id="previous-meds" sectionTag="fieldset" headerTag="legend" headerStyle="title"
             headerCode="pihcore.therapyHistory">
        <div class="section-container">
            <h3>
                <uimessage code="pihcore.prophylaxis"/>
            </h3>
            <table>
                <tr>
                    <td>
                        <label>
                            <uimessage code="pihcore.treatment"/>
                        </label>
                    </td>
                    <td>
                        <label>
                            <uimessage code="pihcore.startDate"/>
                        </label>
                    </td>
                    <td>
                        <label>
                            <uimessage code="pihcore.endDate"/>
                        </label>
                    </td>
                </tr>

                <repeat>
                    <template>
                        <obsgroup groupingConceptId="PIH:1501">
                            <tr>
                                <td>
                                    <obs conceptId="CIEL:1282" answerConceptId="{conceptH}"
                                         answerLabel="{drugname}"
                                         toggle="{id: '{drugname}-hx', style: 'dim'}" />
                                </td>
                                <td class="{drugname}-hx">
                                    <obs conceptId="CIEL:1190"/>
                                </td>
                                <td class="{drugname}-hx">
                                    <obs conceptId="CIEL:1191" />
                                </td>
                            </tr>
                        </obsgroup>
                    </template>
                    <render conceptH="CIEL:105281" drugname="Cotrimoxazole"/>
                </repeat>

                <repeat>
                    <template>
                        <obsgroup groupingConceptId="PIH:1501">
                            <tr>
                                <td>
                                    <obs conceptId="CIEL:1282" answerConceptId="{conceptH}"
                                         answerLabel="{drugname}"
                                         toggle="{id: '{drugname}-hx', style: 'dim'}" />
                                    <p class="radio {drugname}-hx">
                                        <obs conceptId="PIH:13154" style="radio"
                                             answerConceptIds="CIEL:159943, CIEL:159944" />
                                    </p>
                                </td>
                                <td class="{drugname}-hx">
                                    <obs conceptId="CIEL:1190"/>
                                </td>
                                <td class="{drugname}-hx">
                                    <obs conceptId="CIEL:1191" />
                                </td>
                            </tr>
                        </obsgroup>
                    </template>
                    <render conceptH="CIEL:78280"  drugname="Isoniazide"/>
                </repeat>

                <repeat>
                    <template>
                        <obsgroup groupingConceptId="PIH:1501">
                            <tr>
                                <td>
                                    <obs conceptId="CIEL:1282" answerConceptId="{conceptH}"
                                         answerLabel="{drugname}"
                                         toggle="{id: '{drugname}-hx', style: 'dim'}" />
                                </td>
                                <td class="{drugname}-hx">
                                    <obs conceptId="CIEL:1190"/>
                                </td>
                                <td class="{drugname}-hx">
                                    <obs conceptId="CIEL:1191" />
                                </td>
                            </tr>
                        </obsgroup>
                    </template>
                    <render conceptH="CIEL:76488"  drugname="Fluconazole"/>
                    <render conceptH="CIEL:74250"  drugname="Dapsone" />
                </repeat>
            </table>

            <h3>
                <uimessage code="pihcore.lab.hiv.title"/>
            </h3>
            <table>
                <tr>
                    <td>
                        <label>
                            <uimessage code="pihcore.treatment"/>
                        </label>
                    </td>
                    <td>
                        <label>
                            <uimessage code="pihcore.startDate"/>
                        </label>
                    </td>
                    <td>
                        <label>
                            <uimessage code="pihcore.endDate"/>
                        </label>
                    </td>
                </tr>

                <repeat>
                    <template>
                        <obsgroup groupingConceptId="PIH:1590">
                            <tr>
                                <td>
                                    <obs conceptId="CIEL:1282" answerConceptId="{concept}"
                                         toggle="{id: '{hivMedHx}', style: 'dim'}" />
                                </td>
                                <td class="{hivMedHx}">
                                    <obs conceptId="CIEL:1190"/>
                                </td>
                                <td class="{hivMedHx}">
                                    <obs conceptId="CIEL:1191" allowFutureDates="true"/>
                                </td>
                            </tr>
                        </obsgroup>
                    </template>
                    <render concept="PIH:13013"   hivMedHx="tdf3tcEfvNvp" />
                    <render concept="PIH:13014"   hivMedHx="azt3tcEfvNvp"/>
                    <render concept="PIH:13012"   hivMedHx="regD4T"/>
                    <render concept="CIEL:162201" hivMedHx="tdf3tcLpvR"/>
                </repeat>

                <!-- Other HIV regimen -->
                <obsgroup groupingConceptId="PIH:1590">
                    <tr>
                        <td>
                            <obs conceptId="CIEL:1282" answerConceptId="CIEL:5622"
                                 toggle="{id: 'otherHivMedHx', style: 'dim'}" />
                        </td>
                        <td class="otherHivMedHx">
                            <obs conceptId="CIEL:1190"/>
                        </td>
                        <td class="otherHivMedHx">
                            <obs conceptId="CIEL:1191" allowFutureDates="true"/>
                        </td>
                    </tr>
                </obsgroup>

                <tr>
                    <td align="right" class="otherHivMedHx">
                        <label>
                            <uimessage code="zl.ifOtherSpecify"/>
                        </label>
                        <obs conceptId="PIH:1527" size="30"/>
                    </td>
                    <td></td>
                    <td></td>
                </tr>

            </table>
        </div>
    </section>

    <section id="family-plan-section" sectionTag="fieldset" headerTag="legend"
             headerStyle="title" headerCode="pihcore.familyPlanning.title">

        <div id="fp-area" class="section-container">
            <div class="two-columns">
                <div>
                    <obs conceptId="CIEL:163560" style="checkbox"
                         answerConceptId="CIEL:1382" answerCode="pihcore.mch.counselling.familyPlanning" />
                </div>
                <div>
                    <obs conceptId="CIEL:965" style="checkbox"
                         answerConceptId="CIEL:1065" answerCode="pihcore.currentlyUsing"/>
                </div>
            </div>
            <br/>

            <p class="side-by-side">
                <label>
                    <uimessage code="pihcore.fpMethod"/>:
                </label>
                <br/>
                <obsgroup groupingConceptId="PIH:Family planning construct">
                    <obs conceptId="CIEL:374"
                         answerConceptIds="CIEL:159783,CIEL:80784,CIEL:5277,CIEL:190,CIEL:907,CIEL:5275,CIEL:1873,CIEL:1472,CIEL:136163"
                         answerCodes="COC,COP,pihcore.fp.rhythm,Condoms,Depo-provera,pihcore.fp.iud,Implant,pihcore.fp.tubalLig,pihcore.fp.breast"
                         style="radio" />
                    <div class="two-columns">
                        <div>
                            <label>
                                <uimessage code="pihcore.startDate"/>:
                            </label>
                            <obs conceptId="CIEL:163757" />
                        </div>
                        <div>
                            <label>
                                <uimessage code="pihcore.endDate"/>:
                            </label>
                            <obs conceptId="CIEL:163758" />
                        </div>
                    </div>
                </obsgroup>
            </p>

            <p>
                <label>
                    <uimessage code="pihcore.dateImplant"/>:
                </label>
                <obs conceptId="PIH:3203" />
            </p>
        </div>
    </section>


    <section id="presenting-history" sectionTag="fieldset" headerTag="legend" headerStyle="title"
             headerCode="pihcore.history.presentingHistory.title">
        <div class="section-container">
            <p>
                <obs conceptId="PIH:PRESENTING HISTORY" style="textarea" id="presenting-history"/>
            </p>
        </div>
    </section>

    <section id="radiology-findings" sectionTag="fieldset" headerTag="legend" headerStyle="title"
             headerCode="pihcore.rad_findings.title">
        <div class="section-container-color">
            <!-- Use PACS at HUM -->
            <repeat with="['Chest (X-ray)','CIEL:165152','chestXRay'],
                          ['Pelvic (U/S)', 'CIEL:161283', 'pelvicUS'],
                          ['Abdominal (U/S)','CIEL:845','abUS']">
                <p>
                    <obsgroup groupingConceptId="PIH:Radiology report construct">
                        <obs conceptId="PIH:Radiology procedure performed"
                             answerConceptId="{1}" toggle="{2}"
                             answerCode="pihcore.rad.{2}"
                             style="checkbox"/>
                        <div id="{2}" class="two-columns">
                            <obs conceptId="PIH:Radiology report comments"
                                 labelCode="pihcore.findings.label" />
                            <obs conceptId="PIH:12847" labelCode="Date" />
                        </div>
                    </obsgroup>
                </p>
            </repeat>

            <p>
                <label>
                    <uimessage code="zl.ifOtherSpecify"/>
                </label>
                <obsgroup groupingConceptId="PIH:Radiology report construct">
                    <obs conceptId="PIH:Radiology procedure performed"
                         answerClasses="Radiology/Imaging Procedure"
                         style="checkbox"/>
                    <div class="two-columns">
                        <obs conceptId="PIH:Radiology report comments"
                             labelCode="pihcore.findings.label"/>
                        <obs conceptId="PIH:12847" labelCode="Date" />
                    </div>
                </obsgroup>
            </p>
        </div>
    </section>

        <section id="psych" sectionTag="fieldset" headerTag="legend" headerStyle="title"
                  headerCode="pihcore.psycState">
             <div class="section-container">
                 <p class="radio">
                     <label>
                        <uimessage code="pihcore.receivedPostTestCounsel" />
                     </label>
                     <obs conceptId="CIEL:159382" answerConceptIds="CIEL:1066,CIEL:1065"
                          style="radio" />
                 </p>

                 <p>
                     <label>
                         <uimessage code="pihcore.patientReceivedAdvice" />
                     </label>

                     <repeat>
                         <template>
                             <obs conceptId="CIEL:163560"
                                  answerConceptId="{response}"
                                  answerCode="{text}"
                                  style="checkbox" />
                         </template>
                         <render response="CIEL:151185" text="pihcore.cervicalCancerScreeningTreatment"/>
                         <render response="CIEL:165489" text="pihcore.lowRiskBehavior" />
                         <render response="CIEL:1382"   text="pihcore.fpCounseling" />
                         <render response="CIEL:163559" text="pihcore.stiScreening" />
                         <render response="CIEL:159381" text="pihcore.partnerScreening" />
                     </repeat>
                 </p>

                 <p class="radio">
                     <label>
                         <uimessage code="pihcore.referredMH" />
                     </label>
                     <obs conceptId="PIH:13002" answerConceptIds="CIEL:1066,CIEL:1065"
                          answerSeparator="" style="radio" />
                 </p>
             </div>
         </section>

    <section id="id-ev-treatment-cont" sectionTag="fieldset" headerTag="legend"
             headerStyle="title" headerCode="pihcore.evaluation">
        <div class="section-container-color">
                <div>
                    <p class="side-by-side">
                        <label>
                            <uimessage code="pihcore.dailyDoseARV" />
                        </label>
                        <obs id="daily-dose-arv" conceptId="PIH:13649" style="radio"
                             answerConceptIds="CIEL:1065,CIEL:1066">
                            <controls>
                                <when value="CIEL:1066" thenDisplay="#side-by-side-reason"/>
                            </controls>
                        </obs>
                    </p>
                    <p id="side-by-side-reason" style="display:none">
                        <obs conceptId="PIH:1709" labelCode="pihcore.ifNotSpecifyReason"/>
                    </p>
                    <p>
                        <obs conceptId="CIEL:160110" labelCode="pihcore.missingDosesPerMonth"/>
                    </p>
                    <p class="side-by-side">
                        <obs conceptId="PIH:13654" style="radio"
                             labelCode="pihcore.dailyDoseOfCTX"
                             answerConceptIds="CIEL:1065,CIEL:1066"/>
                    </p>
                    <p class="side-by-side">
                        <obs conceptId="CIEL:160111" style="radio"
                             labelCode="pihcore.dailyCHWvisit"
                             answerConceptIds="CIEL:1065,CIEL:1066"/>
                    </p>
                    <p class="side-by-side">
                        <obs conceptId="CIEL:5586" style="radio"
                             labelCode="pihcore.successfulCounselingTreatment"
                             answerConceptIds="CIEL:1065,CIEL:1066"/>
                    </p>
                </div>

            </div>

    </section>


    <br/>

    <ifMode mode="VIEW" include="false">
        <div id="buttons">
            <button id="next" type="button" class="submitButton confirm right">
                <uimessage code="emr.next"/>
                <i class="icon-spinner icon-spin icon-2x" style="display: none; margin-left: 10px;"></i>
            </button>
            <button id="submit" class="submitButton confirm right">
                <uimessage code="mirebalais.save"/>
                <i class="icon-spinner icon-spin icon-2x" style="display: none; margin-left: 10px;"></i>
            </button>
            <button id="cancel" type="button" class="cancel">
                <uimessage code="emr.cancel"/>
            </button>
        </div>
    </ifMode>

</htmlform>
